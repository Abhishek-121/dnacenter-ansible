version: 2.1

jobs:
  build:
    docker:
      - image: cimg/base:current

    parameters: 
      py_version:
        type: string
        default: "3.8.10"

    working_directory: ~/repo 
    #machine: true

    #environment:
    #  PATH: "$HOME/.pyenv/bin:$PATH"
    #  PYENV_ROOT: "$HOME/.pyenv"

    steps:
      - checkout

      - run:
          name: Install Dependencies and Pyenv
          command: |
            set -x
            pyenv local python_<< parameters.py_version >>
            export PYENV_ROOT="/home/circleci/.pyenv"
            export PATH="$PYENV_ROOT/bin:$PATH"
            export PATH="$PYENV_ROOT/shims/python3:$PATH"
            export PATH="$PYENV_ROOT/shims/python:$PATH"
            export PYTHONPATH="$PYENV_ROOT/shims/python3:$PYTHONPATH"
            export PYTHONPATH="$PYENV_ROOT/shims/python:$PYTHONPATH"
            pip install ansible dnacentersdk
            ansible --version
            dnacentersdk --version

workflows:
  test-build:
    jobs:
      - build